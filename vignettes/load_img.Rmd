---
title: "Load_and_present_img"
output: rmarkdown::html_vignette
runtime: shiny
vignette: >
  %\VignetteIndexEntry{Load_and_present_img}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(Stereology)
```


## Stereology

Let's try finding some points in a sponge
```{r}
#line_estimator_app()
```


## Theoretic exploration of an image.

The functions 'bw_mat()' and 'th_i_est()' are meant to be used to give the user theoretic estimators based on an image.  <br/>
The function 'bw_mat()' takes two arguments the path where the image is stored and the threshold used for binary conversion. It returns a list with 2 elements. The first one is a matrix of 1s and 0s, which is generated by the given image. The second one is a plot of the black and white image, in order for the user to check if adjustments to the threshold are needed.   <br/>
  <br/>
The function 'th_i_est()' provides with estimates about the black portions of the image provided using simulations. It takes 6 arguments:  <br/>
- mtr: a matrix generated using the function 'bw_mat()'.
- x: the index of the pixel-row to start subsetting the 'mtr',
- y: the index of the pixel-column to start subsetting the 'mtr',
- dx: the length of pixels used to subset the 'mtr' on the x-axis,
- dy: The length of pixels used to subset the 'mtr' on the y-axis, and
- trial_s: The amount of repetitions used for the simulations. The Binomial distribution is used for the simulations. <br/>

Of course, the higher the number of 'trial_s', the more accurate the simulation will be. However, because of the fact that we are trying to simulate for every single pixel of the image given, for high dimension pictures this will be impossible. This is showcased in the examples later on.

The function then outputs a list containing: <br/>

- submatrix: the part of the matrix we subsetted for,
- p: the probability estimated using this sub-matrix,
- mean_p_hat: the average of the p_hats generated through simulations, and
- variance_p_hat: the variance of the p_hats generated through simulations.

### Examples of theoretical exploration of images.

Below, there are two examples of the functions 'bw_mat()' and 'th_i_est()' being used. <br/>

#### Example A.

First, the image file to be used is loaded onto R, then the function bw_mat() is used. In this case, the  1s and 0s represent whether the area is 'filled' by sponge or not respectively.  As we can see a 1899 by 1266 matrix is generated. <br/>
After using the generated matrix ('a$matrix'), we make a submatrix by starting from pixel/entry (x=)400 traversing for a length(dx=) of 10 on the x-axis. For the y-axis we start from pixel/entry (y=)100 and traverse for a length(dy=) of 15. As a last argument in the function, we specify the trial size (trial_s) to be 10000. 

```{r}
# Loading the image.

# To use a PNG/JPEG/BMP image stored on your computer try:
# path <- "~/images.png"
path <- system.file('extdata/sponge3.jpg',package='Stereology')

# Applying bw_mat().
a <- bw_mat(path)
str(a)

# Setting seed.
set.seed(17)

# Applying th_i_ests().
est_l <- th_i_ests(mtr = a$img_mat, x = 400, y = 100, dx= 5, dy = 10, trial_s = 100)

# Print all different outputs.
est_l$submatrix
est_l$p
est_l$mean_p_hat
est_l$variance_p_hat
```

#### Example B.

In this example, we focus our attention on the threshold and simulation parts.
First, we present the image under 3 different thresholds (0.75, 0.65 and 0.55 respectively) to highlight the fact that luminosity of the image plays an important part.
Then, we observe the difference of 1000 repetitions of the simulation and 100 ones.

```{r}
# Loading the image.
path2 <- system.file('extdata/smallsponge.jpg',package='Stereology')

# Applying bw_mat().
b <- bw_mat(path2, 0.75)
d <- bw_mat(path2, 0.65)
e <- bw_mat(path2, 0.55)

# Image dimensions
dim(b$img_mat)

# Setting seed.
set.seed(123)

# Applying th_i_ests().
est_l2a <- th_i_ests(mtr = b$img_mat, x = 210, y = 200, dx= 10, dy = 10, trial_s = 1000)
est_l2b <- th_i_ests(mtr = b$img_mat, x = 210, y = 200, dx= 10, dy = 10, trial_s = 100)

# Print just mean_p_hat and variance_p_hat.

tab <- matrix(c(est_l2a$mean_p_hat, est_l2a$variance_p_hat, 
                est_l2b$mean_p_hat, est_l2b$variance_p_hat), ncol=2, byrow=TRUE)
colnames(tab) <- c('Mean p_hat','Variance p_hat')
rownames(tab) <- c('1000 repetitions','100 repetitions')
tab <- as.table(tab)
tab

#est_l2a$mean_p_hat
#est_l2a$variance_p_hat
```






